<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR ìŠ¤ìºë„ˆ - ëª¨ë“  ì´ë¯¸ì§€ ì¸ì‹</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #000;
            color: white;
            overflow: hidden;
        }

        .scanner-ui {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .scanner-status {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            font-weight: 500;
        }

        .status-icon {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ff6b35;
            animation: pulse 2s infinite;
        }

        .status-icon.scanning {
            background: #4CAF50;
        }

        .status-icon.detected {
            background: #2196F3;
            animation: none;
        }

        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
            100% { opacity: 1; transform: scale(1); }
        }

        .scanner-controls {
            display: flex;
            gap: 10px;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        .control-btn.active {
            background: #ff6b35;
        }

        .scanner-frame {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 280px;
            height: 280px;
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 20px;
            z-index: 999;
            pointer-events: none;
        }

        .scanner-frame::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            border: 2px solid #ff6b35;
            border-radius: 25px;
            opacity: 0;
            animation: scanFrame 3s infinite;
        }

        @keyframes scanFrame {
            0%, 100% { opacity: 0; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.1); }
        }

        .instructions {
            position: fixed;
            bottom: 80px;
            left: 20px;
            right: 20px;
            text-align: center;
            z-index: 1000;
        }

        .instruction-card {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .instruction-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #ff6b35;
        }

        .instruction-text {
            font-size: 14px;
            opacity: 0.9;
            line-height: 1.4;
        }

        .video-controls {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
            z-index: 1000;
        }

        .video-btn {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
            display: none;
        }

        .video-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
        }

        .video-btn.show {
            display: block;
        }

        .detection-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(33, 150, 243, 0.1);
            z-index: 500;
            display: none;
            animation: detectionPulse 1s ease-in-out;
        }

        @keyframes detectionPulse {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0.1; }
        }

        #ar-scene {
            width: 100vw;
            height: 100vh;
        }

        .sample-targets {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .sample-target {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 10px;
            text-align: center;
            font-size: 10px;
            opacity: 0.7;
        }

        .sample-icon {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .floating-tip {
            position: fixed;
            top: 120px;
            left: 20px;
            right: 20px;
            background: rgba(76, 175, 80, 0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            text-align: center;
            font-size: 12px;
            z-index: 1001;
            display: none;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- ìŠ¤ìºë„ˆ UI -->
    <div class="scanner-ui">
        <div class="scanner-status">
            <div class="status-icon" id="statusIcon"></div>
            <span id="statusText">AR ìŠ¤ìºë„ˆ ì‹œì‘ ì¤‘...</span>
        </div>
        <div class="scanner-controls">
            <button class="control-btn" id="torchBtn" onclick="toggleTorch()">ğŸ’¡</button>
            <button class="control-btn" id="cameraBtn" onclick="switchCamera()">ğŸ”„</button>
            <button class="control-btn" onclick="showHelp()">â“</button>
        </div>
    </div>

    <!-- ìŠ¤ìº” í”„ë ˆì„ -->
    <div class="scanner-frame"></div>

    <!-- ê°ì§€ ì˜¤ë²„ë ˆì´ -->
    <div class="detection-overlay" id="detectionOverlay"></div>

    <!-- íŒ ë©”ì‹œì§€ -->
    <div class="floating-tip" id="floatingTip"></div>

    <!-- ì‚¬ìš© ì•ˆë‚´ -->
    <div class="instructions" id="instructions">
        <div class="instruction-card">
            <div class="instruction-title">ğŸ“· AR ìŠ¤ìºë„ˆ ì‚¬ìš©ë²•</div>
            <div class="instruction-text">
                ì¹´ë©”ë¼ë¥¼ ì•„ë˜ íƒ€ì…ì˜ ì´ë¯¸ì§€ì— ë¹„ì¶°ì£¼ì„¸ìš”<br>
                ìë™ìœ¼ë¡œ ê°ì§€ë˜ì–´ AR ì½˜í…ì¸ ê°€ ì¬ìƒë©ë‹ˆë‹¤
            </div>
            <div class="sample-targets">
                <div class="sample-target">
                    <div class="sample-icon">ğŸ“š</div>
                    <div>ì±…/ì¡ì§€</div>
                </div>
                <div class="sample-target">
                    <div class="sample-icon">ğŸ·ï¸</div>
                    <div>ëª…í•¨/ì¹´ë“œ</div>
                </div>
                <div class="sample-target">
                    <div class="sample-icon">ğŸ–¼ï¸</div>
                    <div>í¬ìŠ¤í„°</div>
                </div>
                <div class="sample-target">
                    <div class="sample-icon">ğŸ“±</div>
                    <div>QRì½”ë“œ</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ë¹„ë””ì˜¤ ì»¨íŠ¸ë¡¤ -->
    <div class="video-controls">
        <button class="video-btn" id="playBtn" onclick="playVideo()">â–¶ï¸ ì¬ìƒ</button>
        <button class="video-btn" id="pauseBtn" onclick="pauseVideo()">â¸ï¸ ì¼ì‹œì •ì§€</button>
        <button class="video-btn" id="stopBtn" onclick="stopVideo()">â¹ï¸ ì •ì§€</button>
    </div>

    <!-- A-Frame AR Scene -->
    <a-scene 
        id="ar-scene"
        mindar-image="imageTargetSrc: #; maxTrack: 5; uiLoading: no; uiScanning: no; uiError: no;"
        color-space="sRGB" 
        renderer="colorManagement: true, physicallyCorrectLights"
        vr-mode-ui="enabled: false" 
        device-orientation-permission-ui="enabled: false"
        embedded
    >
        <a-assets>
            <!-- ìƒ˜í”Œ ë¹„ë””ì˜¤ë“¤ -->
            <video id="video1" 
                   src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4"
                   preload="auto" loop="true" muted="true" webkit-playsinline="true" playsinline="true" crossorigin="anonymous">
            </video>
            <video id="video2" 
                   src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerEscapes.mp4"
                   preload="auto" loop="true" muted="true" webkit-playsinline="true" playsinline="true" crossorigin="anonymous">
            </video>
            <video id="video3" 
                   src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4"
                   preload="auto" loop="true" muted="true" webkit-playsinline="true" playsinline="true" crossorigin="anonymous">
            </video>
            <video id="video4" 
                   src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4"
                   preload="auto" loop="true" muted="true" webkit-playsinline="true" playsinline="true" crossorigin="anonymous">
            </video>
            <video id="video5" 
                   src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerFun.mp4"
                   preload="auto" loop="true" muted="true" webkit-playsinline="true" playsinline="true" crossorigin="anonymous">
            </video>
        </a-assets>

        <!-- ê°€ìƒ íƒ€ê²Ÿë“¤ (ì¼ë°˜ì ì¸ ì´ë¯¸ì§€ íŒ¨í„´ì— ë°˜ì‘) -->
        <a-entity id="universal-target" position="0 0 -2">
            <a-video 
                id="ar-video"
                src="#video1" 
                position="0 0 0.1" 
                rotation="0 0 0"
                width="2" 
                height="1.5"
                material="transparent: true; alphaTest: 0.5"
                visible="false">
            </a-video>
            <a-plane 
                width="2" 
                height="1.5" 
                position="0 0 0"
                material="color: #ff6b35; opacity: 0.1"
                visible="false">
            </a-plane>
        </a-entity>

        <a-entity camera look-controls="enabled: true" wasd-controls="enabled: false"></a-entity>
    </a-scene>

    <script>
        let isScanning = false;
        let currentVideo = null;
        let userInteracted = false;
        let torchEnabled = false;
        let cameraFacing = 'environment';
        let detectionCount = 0;
        let lastDetectionTime = 0;
        let videoIndex = 0;
        const videos = ['video1', 'video2', 'video3', 'video4', 'video5'];

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            initializeScanner();
            setupEventListeners();
        });

        function initializeScanner() {
            updateStatus('ì¹´ë©”ë¼ ê¶Œí•œ ìš”ì²­ ì¤‘...', 'scanning');
            
            // ì‚¬ìš©ì ìƒí˜¸ì‘ìš© ê°ì§€
            document.addEventListener('click', enableAudio, { once: true });
            document.addEventListener('touchstart', enableAudio, { once: true });
            
            // AR ì‹œìŠ¤í…œ ì¤€ë¹„
            setTimeout(() => {
                updateStatus('AR ìŠ¤ìºë„ˆ ì¤€ë¹„ ì™„ë£Œ', 'scanning');
                startUniversalDetection();
                hideInstructions();
            }, 3000);
        }

        function setupEventListeners() {
            // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
            document.addEventListener('keydown', function(e) {
                switch(e.key) {
                    case ' ':
                        e.preventDefault();
                        simulateDetection();
                        break;
                    case 'p':
                        playVideo();
                        break;
                    case 's':
                        stopVideo();
                        break;
                }
            });
        }

        function startUniversalDetection() {
            // ë²”ìš© ì´ë¯¸ì§€ ê°ì§€ ì‹œë®¬ë ˆì´ì…˜
            setInterval(() => {
                // ì‹¤ì œë¡œëŠ” ì´ë¯¸ì§€ ë¶„ì„ ì•Œê³ ë¦¬ì¦˜ì´ ë“¤ì–´ê°ˆ ê³³
                if (Math.random() > 0.98) { // 2% í™•ë¥ ë¡œ ê°ì§€ ì‹œë®¬ë ˆì´ì…˜
                    simulateDetection();
                }
            }, 100);

            // ì£¼ê¸°ì ìœ¼ë¡œ íŒ í‘œì‹œ
            setInterval(() => {
                showRandomTip();
            }, 15000);
        }

        function simulateDetection() {
            const now = Date.now();
            if (now - lastDetectionTime < 2000) return; // 2ì´ˆ ì¿¨ë‹¤ìš´
            
            lastDetectionTime = now;
            detectionCount++;
            
            // ê°ì§€ íš¨ê³¼
            showDetectionEffect();
            
            // ëœë¤ ë¹„ë””ì˜¤ ì„ íƒ
            videoIndex = Math.floor(Math.random() * videos.length);
            const selectedVideo = videos[videoIndex];
            
            // AR ë¹„ë””ì˜¤ í‘œì‹œ
            showARVideo(selectedVideo);
            
            updateStatus(`ğŸ¯ ì´ë¯¸ì§€ ê°ì§€ë¨! (${detectionCount}íšŒ)`, 'detected');
            showFloatingTip('ì´ë¯¸ì§€ê°€ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤! AR ë¹„ë””ì˜¤ê°€ ì¬ìƒë©ë‹ˆë‹¤.');
        }

        function showDetectionEffect() {
            const overlay = document.getElementById('detectionOverlay');
            overlay.style.display = 'block';
            
            setTimeout(() => {
                overlay.style.display = 'none';
            }, 1000);
        }

        function showARVideo(videoId) {
            // ì´ì „ ë¹„ë””ì˜¤ ì •ì§€
            if (currentVideo) {
                currentVideo.pause();
                currentVideo.currentTime = 0;
            }
            
            // ìƒˆ ë¹„ë””ì˜¤ ì„¤ì •
            const arVideo = document.getElementById('ar-video');
            const video = document.getElementById(videoId);
            
            if (arVideo && video) {
                arVideo.setAttribute('src', `#${videoId}`);
                arVideo.setAttribute('visible', true);
                
                // ë¹„ë””ì˜¤ ì¬ìƒ
                currentVideo = video;
                if (userInteracted) {
                    video.muted = false;
                }
                video.play().catch(console.error);
                
                // ë¹„ë””ì˜¤ ì»¨íŠ¸ë¡¤ í‘œì‹œ
                showVideoControls();
                
                // 5ì´ˆ í›„ ìë™ ìˆ¨ê¹€
                setTimeout(() => {
                    hideARVideo();
                }, 8000);
            }
        }

        function hideARVideo() {
            const arVideo = document.getElementById('ar-video');
            if (arVideo) {
                arVideo.setAttribute('visible', false);
            }
            
            if (currentVideo) {
                currentVideo.pause();
                currentVideo.currentTime = 0;
                currentVideo = null;
            }
            
            hideVideoControls();
            updateStatus('ì´ë¯¸ì§€ë¥¼ ì°¾ê³  ìˆìŠµë‹ˆë‹¤...', 'scanning');
        }

        function showVideoControls() {
            const buttons = document.querySelectorAll('.video-btn');
            buttons.forEach(btn => btn.classList.add('show'));
        }

        function hideVideoControls() {
            const buttons = document.querySelectorAll('.video-btn');
            buttons.forEach(btn => btn.classList.remove('show'));
        }

        function playVideo() {
            if (currentVideo) {
                if (userInteracted) {
                    currentVideo.muted = false;
                }
                currentVideo.play().catch(console.error);
                updateStatus('ğŸ¬ ë¹„ë””ì˜¤ ì¬ìƒ ì¤‘', 'detected');
            }
        }

        function pauseVideo() {
            if (currentVideo) {
                currentVideo.pause();
                updateStatus('â¸ï¸ ë¹„ë””ì˜¤ ì¼ì‹œì •ì§€', 'detected');
            }
        }

        function stopVideo() {
            hideARVideo();
        }

        function toggleTorch() {
            // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ì¹´ë©”ë¼ í”Œë˜ì‹œ ì œì–´
            torchEnabled = !torchEnabled;
            const btn = document.getElementById('torchBtn');
            btn.classList.toggle('active', torchEnabled);
            btn.textContent = torchEnabled ? 'ğŸ”¦' : 'ğŸ’¡';
            
            showFloatingTip(torchEnabled ? 'í”Œë˜ì‹œ ì¼œì§' : 'í”Œë˜ì‹œ êº¼ì§');
        }

        function switchCamera() {
            // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ì „ë©´/í›„ë©´ ì¹´ë©”ë¼ ì „í™˜
            cameraFacing = cameraFacing === 'environment' ? 'user' : 'environment';
            const btn = document.getElementById('cameraBtn');
            btn.classList.add('active');
            
            setTimeout(() => {
                btn.classList.remove('active');
            }, 1000);
            
            showFloatingTip(cameraFacing === 'environment' ? 'í›„ë©´ ì¹´ë©”ë¼' : 'ì „ë©´ ì¹´ë©”ë¼');
        }

        function showHelp() {
            const instructions = document.getElementById('instructions');
            instructions.style.display = instructions.style.display === 'none' ? 'block' : 'none';
        }

        function hideInstructions() {
            setTimeout(() => {
                const instructions = document.getElementById('instructions');
                instructions.style.display = 'none';
            }, 10000);
        }

        function enableAudio() {
            userInteracted = true;
            showFloatingTip('ğŸ”Š ì˜¤ë””ì˜¤ê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤');
        }

        function updateStatus(message, type) {
            const statusText = document.getElementById('statusText');
            const statusIcon = document.getElementById('statusIcon');
            
            statusText.textContent = message;
            statusIcon.className = `status-icon ${type}`;
        }

        function showFloatingTip(message) {
            const tip = document.getElementById('floatingTip');
            tip.textContent = message;
            tip.style.display = 'block';
            
            setTimeout(() => {
                tip.style.display = 'none';
            }, 3000);
        }

        function showRandomTip() {
            const tips = [
                'ğŸ’¡ ì¡°ëª…ì´ ë°ì€ ê³³ì—ì„œ ìŠ¤ìº”í•´ë³´ì„¸ìš”',
                'ğŸ“ ì´ë¯¸ì§€ë¥¼ ì •ë©´ì—ì„œ ë¹„ì¶°ì£¼ì„¸ìš”',
                'ğŸ“ ì¹´ë©”ë¼ì™€ 20-50cm ê±°ë¦¬ë¥¼ ìœ ì§€í•˜ì„¸ìš”',
                'âœ‹ ì†ì„ ì•ˆì •ì ìœ¼ë¡œ ìœ ì§€í•´ì£¼ì„¸ìš”',
                'ğŸ” ì„ ëª…í•˜ê³  ëŒ€ë¹„ê°€ ê°•í•œ ì´ë¯¸ì§€ê°€ ë” ì˜ ì¸ì‹ë©ë‹ˆë‹¤'
            ];
            
            const randomTip = tips[Math.floor(Math.random() * tips.length)];
            showFloatingTip(randomTip);
        }

        // ëª¨ë°”ì¼ ìµœì í™”
        if (/Mobi|Android/i.test(navigator.userAgent)) {
            // í™”ë©´ íšŒì „ ì‹œ ìµœì í™”
            window.addEventListener('orientationchange', function() {
                setTimeout(() => {
                    window.scrollTo(0, 1);
                }, 100);
            });
            
            // í„°ì¹˜ ìµœì í™”
            document.addEventListener('touchstart', function(e) {
                if (e.touches.length === 2) {
                    // ë”ë¸” í„°ì¹˜ë¡œ ê°ì§€ ì‹œë®¬ë ˆì´ì…˜
                    simulateDetection();
                }
            });
        }

        // PCì—ì„œ í…ŒìŠ¤íŠ¸ìš© - ë§ˆìš°ìŠ¤ í´ë¦­ìœ¼ë¡œ ê°ì§€ ì‹œë®¬ë ˆì´ì…˜
        document.addEventListener('click', function(e) {
            if (e.target.id === 'ar-scene' || e.target.tagName === 'A-SCENE') {
                simulateDetection();
            }
        });

        // ì˜¤ë¥˜ ì²˜ë¦¬
        window.addEventListener('error', function(e) {
            console.error('Scanner error:', e.error);
            updateStatus('âš ï¸ ìŠ¤ìºë„ˆ ì˜¤ë¥˜ ë°œìƒ', 'scanning');
        });
    </script>
</body>
</html> 